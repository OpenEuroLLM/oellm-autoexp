# Aggressive restart policy for Megatron
# Restarts on most errors except permanent failures (OOM, code bugs)
# Good for debugging or when you want maximum uptime

policies:
  - mode: crash
    implementation:
      class_name: SelectiveRestartPolicy
      max_retries: 5
      restart_reason: Error detected, attempting restart
      stop_reason: Permanent failure, stopping
      default_action: restart  # Restart by default unless excluded

      # Only exclude these error types (known permanent failures)
      exclude_error_types:
        - oom                # Out of memory - config change required
        - exception          # Python exceptions - likely code bug

  - mode: stall
    implementation:
      class_name: AlwaysRestartPolicy
      reason: Job stalled, restarting
      max_retries: 3

  - mode: timeout
    implementation:
      class_name: AlwaysRestartPolicy
      reason: Job timeout, restarting
      max_retries: 2

  - mode: success
    implementation:
      class_name: NoRestartPolicy
      message: Job completed successfully
